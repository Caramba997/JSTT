[{"url":"https://api.github.com/repos/avajs/ava/issues/2685","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/2685/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/2685/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/2685/events","html_url":"https://github.com/avajs/ava/pull/2685","id":807933970,"node_id":"MDExOlB1bGxSZXF1ZXN0NTczMDcxMjM2","number":2685,"title":"Introducing AVA snapshots v3","user":{"login":"ninevra","id":7622339,"node_id":"MDQ6VXNlcjc2MjIzMzk=","avatar_url":"https://avatars.githubusercontent.com/u/7622339?v=4","gravatar_id":"","url":"https://api.github.com/users/ninevra","html_url":"https://github.com/ninevra","followers_url":"https://api.github.com/users/ninevra/followers","following_url":"https://api.github.com/users/ninevra/following{/other_user}","gists_url":"https://api.github.com/users/ninevra/gists{/gist_id}","starred_url":"https://api.github.com/users/ninevra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ninevra/subscriptions","organizations_url":"https://api.github.com/users/ninevra/orgs","repos_url":"https://api.github.com/users/ninevra/repos","events_url":"https://api.github.com/users/ninevra/events{/privacy}","received_events_url":"https://api.github.com/users/ninevra/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":25,"created_at":"2021-02-14T10:40:47Z","updated_at":"2021-03-13T16:22:02Z","closed_at":"2021-03-13T16:21:54Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/2685","html_url":"https://github.com/avajs/ava/pull/2685","diff_url":"https://github.com/avajs/ava/pull/2685.diff","patch_url":"https://github.com/avajs/ava/pull/2685.patch","merged_at":"2021-03-13T16:21:53Z"},"body":"Implements a new snapshot file format containing all information necessary to generate the snapshot report file.\r\n\r\nAllows the use of `test.skip()`, `test.only()`, `--match`, line number selection, and `t.snapshot.skip()` during `--update-snapshots` runs.\r\n\r\nCloses #2634 by removing the \"Could not update snapshots\" case entirely.\r\nCloses #2635 by allowing existing test & assertion selection mechanisms to be used with `--update-snapshots`.\r\nHopefully will assist with #1768 and #2099.\r\n\r\n## Current proposed snapshot file format:\r\n\r\n- Readable prefix: `AVA Snapshot v3\\n`\r\n- Snapshot version (UInt16LE): 3\r\n- sha256 checksum of the following\r\n- gzip compressed data:\r\n    - CBOR encoded data:\r\n        ```\r\n        {\r\n          blocks: [\r\n            {\r\n              title: \"A test title\",\r\n              snapshots: [\r\n                {\r\n                  label: \"A snapshot label\",\r\n                  buffer: /* Serialized concordance descriptor */\r\n                },\r\n                ...\r\n              ]\r\n            },\r\n            ...\r\n          ]\r\n        }\r\n        ```\r\n\r\nNotes:\r\n- The `label` field is absent unless the user supplied a label. This allows changing the default snapshot label if desired in the future.\r\n- The `buffer` field may be absent, if the snapshot has only ever been skipped. Such snapshots are currently rendered as `<No Data>`.\r\n- Currently, some data still exists only in the report file, namely the filenames of the test file and the snapshot file. This information can be derived from the name of the snapshot file, but theoretically that could change in the future.\r\n\r\n### Pros of the proposed format:\r\n- The snapshot report can now be regenerated from the snapshot file.\r\n    - Enables the use of test selection mechanisms during `--update-snapshots`\r\n    - Allows snapshot reports to be kept always in order, rather than the previous approach of appending changes at the end.\r\n    - Prerequisite for any feature that edits snapshots without overwriting them entirely.\r\n- AVA now maintains less byte-manipulation code\r\n- The snapshot format is easier (though not trivial, because of the gzipping and the header) for third-parties to read\r\n- Adding new properties either to snapshots, to blocks, or to the file overall should be easy and remain readable by older AVAs (though older AVAs may or may not preserve such unrecognized data when updating the .snap file)\r\n\r\n### Cons of the proposed format:\r\n- AVA can't totally guarantee that the snapshot file format is deterministic; some leeway is given to the CBOR encoder. .snap files might show spurious changes e.g. between minor versions of the CBOR encoder.\r\n- AVA's attack surface is changed. Attackers remain able to submit a malicious .snap file in a pull request, in hope of exploting potential bugs in AVA to exfiltrate repository secrets from CI runs or gain control of developers' machines. The total amount of code exposed to such an attack is significantly increased, and unless we carefully filter the result of CBOR decoding (not currently done), such an attacker can produce unexpected javascript types and values. On the other hand, the binary-parsing code now has rather more eyes on it.\r\n\r\n## Other changes:\r\n\r\n### Frontend:\r\n- Rather than append new tests to the old report, adding new tests without `--update-snaphots` now maintains declaration-order.\r\n- When the snapshot report is changed, tests not touched in that run (e.g. removed tests, tests which no longer use snapshots) are moved to the end of the report, maintaining their previous order among themselves.\r\n\r\n### Edge cases:\r\n- If `--update-snapshots` is passed and the only use of snapshots is in discarded `t.try()` attempts, then the snapshot file is removed. There's no snapshot data to record in this case, so I don't see any reason to keep the file.\r\n- If `t.snapshot.skip(); t.snapshot();` is added at the end of a test, `RangeError` is no longer thrown; instead a \"blank space\" is recorded for the skipped snapshot. This is currently rendered in the snapshot report as `<No Data>`.\r\n- `snapshot-manager` now assumes `Array.prototype.sort` is stable. This is the true in all supported Node versions afaik, and is required by the standard as of ecmascript 2019, but notably is false in node v10. If `Array.prototype.sort` is not stable, the snapshot report order may not be deterministic.\r\n\r\n### Backend:\r\n- The snapshot file is eagerly loaded in the `Runner` constructor, rather than lazily loaded.\r\n     - `Runner` always emits a dependency on its `.snap` file, even in `--update-snapshots` mode and even if no snapshot assertions are performed.\r\n     - In some very narrow edge cases where the snapshot file has a valid version and checksum but unreadable data, this could result in throwing an unhelpful error. AVA@3 only threw such errors if snapshots were actually used.\r\n- Introduces a dependency on `cbor`.\r\n- Removes a dependency on `md5-hex`.\r\n\r\n## TODO:\r\n- [x] Implement a placeholder snapshot format containing the necessary information\r\n- [x] Test that snapshot reports can be regenerated from `.snap` files \r\n- [x] Allow running `--update-snapshots` with `test.skip()`, `t.snapshot.skip()`, `test.only()`, `--match`, line number selection\r\n    - [x] Finish testing this\r\n    - [x] Document this\r\n- [x] Refactor & clean up code\r\n    - [x] Ordering data should be collected as-it-happens, like `skipBlock()` and `skipSnapshot()`, not once at load time \r\n    - [x] Now that the snapshot manager has all the information on skipping tests and snapshots, `cleanSnapshots()` fits more naturally as part of `Manager#save()`. But,\r\n    - [x] The above requires that the snapshot manager exist when not used, which conflicts with `Runner`'s lazy-loading behavior, which in turn is relied on by existing `Runner` unit-test suites.\r\n    - [x] Remove code for handling `cannotSave` events\r\n- [x] Debug the performance issues somehow. Are they caused by this PR or preexisting? Are they specific to CI, specific to temp dirs, or neither?\r\n    - Tests were just spawning too many processes in CI. Fixed.\r\n- [x] Finalize the snapshot file format","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/2685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/2685/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/avajs/ava/issues/2341","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/2341/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/2341/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/2341/events","html_url":"https://github.com/avajs/ava/pull/2341","id":545422049,"node_id":"MDExOlB1bGxSZXF1ZXN0MzU5MzA0NjUy","number":2341,"title":"Directly use picomatch","user":{"login":"novemberborn","id":33538,"node_id":"MDQ6VXNlcjMzNTM4","avatar_url":"https://avatars.githubusercontent.com/u/33538?v=4","gravatar_id":"","url":"https://api.github.com/users/novemberborn","html_url":"https://github.com/novemberborn","followers_url":"https://api.github.com/users/novemberborn/followers","following_url":"https://api.github.com/users/novemberborn/following{/other_user}","gists_url":"https://api.github.com/users/novemberborn/gists{/gist_id}","starred_url":"https://api.github.com/users/novemberborn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/novemberborn/subscriptions","organizations_url":"https://api.github.com/users/novemberborn/orgs","repos_url":"https://api.github.com/users/novemberborn/repos","events_url":"https://api.github.com/users/novemberborn/events{/privacy}","received_events_url":"https://api.github.com/users/novemberborn/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-01-05T14:06:20Z","updated_at":"2020-01-05T14:16:50Z","closed_at":"2020-01-05T14:16:48Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/2341","html_url":"https://github.com/avajs/ava/pull/2341","diff_url":"https://github.com/avajs/ava/pull/2341.diff","patch_url":"https://github.com/avajs/ava/pull/2341.patch","merged_at":"2020-01-05T14:16:48Z"},"body":"This is a nice improvement, triggered by CI failures caused by the latest `picomatch` version which we were using indirectly. So now, we use it directly, and get performance updates, and can avoid the regression.","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/2341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/2341/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/avajs/ava/issues/1661","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/1661/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/1661/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/1661/events","html_url":"https://github.com/avajs/ava/pull/1661","id":292212293,"node_id":"MDExOlB1bGxSZXF1ZXN0MTY1NTcxNTM3","number":1661,"title":"Share glob caches","user":{"login":"novemberborn","id":33538,"node_id":"MDQ6VXNlcjMzNTM4","avatar_url":"https://avatars.githubusercontent.com/u/33538?v=4","gravatar_id":"","url":"https://api.github.com/users/novemberborn","html_url":"https://github.com/novemberborn","followers_url":"https://api.github.com/users/novemberborn/followers","following_url":"https://api.github.com/users/novemberborn/following{/other_user}","gists_url":"https://api.github.com/users/novemberborn/gists{/gist_id}","starred_url":"https://api.github.com/users/novemberborn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/novemberborn/subscriptions","organizations_url":"https://api.github.com/users/novemberborn/orgs","repos_url":"https://api.github.com/users/novemberborn/repos","events_url":"https://api.github.com/users/novemberborn/events{/privacy}","received_events_url":"https://api.github.com/users/novemberborn/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-01-28T15:18:27Z","updated_at":"2018-01-29T17:30:45Z","closed_at":"2018-01-29T17:30:25Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/1661","html_url":"https://github.com/avajs/ava/pull/1661","diff_url":"https://github.com/avajs/ava/pull/1661.diff","patch_url":"https://github.com/avajs/ava/pull/1661.patch","merged_at":"2018-01-29T17:30:24Z"},"body":"Share glob caches when finding test and helper files, and when rerunning all files in watch mode. This should provide a performance improvement, though I suppose certain file changes in watch mode may no longer be detected. I can't quite figure out what those would be though.","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/1661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/1661/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/avajs/ava/issues/1467","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/1467/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/1467/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/1467/events","html_url":"https://github.com/avajs/ava/pull/1467","id":245154293,"node_id":"MDExOlB1bGxSZXF1ZXN0MTMyMTA0NDE5","number":1467,"title":"Limit concurrency to the number of CPU cores","user":{"login":"sindresorhus","id":170270,"node_id":"MDQ6VXNlcjE3MDI3MA==","avatar_url":"https://avatars.githubusercontent.com/u/170270?v=4","gravatar_id":"","url":"https://api.github.com/users/sindresorhus","html_url":"https://github.com/sindresorhus","followers_url":"https://api.github.com/users/sindresorhus/followers","following_url":"https://api.github.com/users/sindresorhus/following{/other_user}","gists_url":"https://api.github.com/users/sindresorhus/gists{/gist_id}","starred_url":"https://api.github.com/users/sindresorhus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sindresorhus/subscriptions","organizations_url":"https://api.github.com/users/sindresorhus/orgs","repos_url":"https://api.github.com/users/sindresorhus/repos","events_url":"https://api.github.com/users/sindresorhus/events{/privacy}","received_events_url":"https://api.github.com/users/sindresorhus/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-07-24T17:35:27Z","updated_at":"2017-07-30T20:27:21Z","closed_at":"2017-07-30T20:27:18Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/1467","html_url":"https://github.com/avajs/ava/pull/1467","diff_url":"https://github.com/avajs/ava/pull/1467.diff","patch_url":"https://github.com/avajs/ava/pull/1467.patch","merged_at":"2017-07-30T20:27:18Z"},"body":"Fixes #966\r\n\r\nThis considerably improves the performance for the common case. Most users have many test files and their CPUs got overloaded. And few knew about the concurrency option.\r\n\r\nThis has the downside of making `test.only()` not be exclusive with multiple test files, but there are just too many limitations caused by it. I think this change is worth it.\r\n\r\nI've chosen to go with a default concurrency of the number of CPU cores. We can tweak it based on real usage data later on.","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/1467/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/1467/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/avajs/ava/issues/1068","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/1068/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/1068/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/1068/events","html_url":"https://github.com/avajs/ava/pull/1068","id":181603503,"node_id":"MDExOlB1bGxSZXF1ZXN0ODgzOTMxODc=","number":1068,"title":"Reduce transpilation on Node.js >=4","user":{"login":"sindresorhus","id":170270,"node_id":"MDQ6VXNlcjE3MDI3MA==","avatar_url":"https://avatars.githubusercontent.com/u/170270?v=4","gravatar_id":"","url":"https://api.github.com/users/sindresorhus","html_url":"https://github.com/sindresorhus","followers_url":"https://api.github.com/users/sindresorhus/followers","following_url":"https://api.github.com/users/sindresorhus/following{/other_user}","gists_url":"https://api.github.com/users/sindresorhus/gists{/gist_id}","starred_url":"https://api.github.com/users/sindresorhus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sindresorhus/subscriptions","organizations_url":"https://api.github.com/users/sindresorhus/orgs","repos_url":"https://api.github.com/users/sindresorhus/repos","events_url":"https://api.github.com/users/sindresorhus/events{/privacy}","received_events_url":"https://api.github.com/users/sindresorhus/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-10-07T07:40:20Z","updated_at":"2016-10-09T14:48:07Z","closed_at":"2016-10-09T14:47:56Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/1068","html_url":"https://github.com/avajs/ava/pull/1068","diff_url":"https://github.com/avajs/ava/pull/1068.diff","patch_url":"https://github.com/avajs/ava/pull/1068.patch","merged_at":"2016-10-09T14:47:56Z"},"body":"Better initial startup performance and improved stack traces. I mostly did this for better stack traces. Related to https://github.com/avajs/ava/issues/148. Long-term we'll want to use [`babel-preset-env`](https://github.com/babel/babel-preset-env), but it's too immature at the moment. I didn't include a specific preset for Node.js 6 as it didn't improve performance and will be solved with the eventual use of `babel-preset-env`.\n\nYou can see that the initial cold run improved by more than a second after this change.\n## Before\n### Without cache\n\n```\n~/dev/got master\n❯ time ava\n\n  85 passed\n\nava --no-local  8.98s user 0.86s system 108% cpu 9.060 total\n```\n### With cache\n\n```\n~/dev/got master\n❯ time ava\n\n  85 passed\n\nava --no-local  5.06s user 0.62s system 101% cpu 5.621 total\n```\n## After\n### Without cache\n\n```\n~/dev/got master\n❯ time ava               \n\n  85 passed\n\nava --no-local  7.29s user 0.81s system 104% cpu 7.783 total\n```\n### With cache\n\n```\n~/dev/got master\n❯ time ava\n\n  85 passed\n\nava --no-local  5.18s user 0.63s system 106% cpu 5.476 total\n```\n## \n## Stack trace\n### Before\n\n```\n_callee3$ (error.js:40:5)\n    tryCatch (/Users/sindresorhus/dev/ava/node_modules/regenerator-runtime/runtime.js:62:40)\n    GeneratorFunctionPrototype.invoke [as _invoke] (/Users/sindresorhus/dev/ava/node_modules/regenerator-runtime/runtime.js:336:22)\n    GeneratorFunctionPrototype.prototype.(anonymous function) [as throw] (/Users/sindresorhus/dev/ava/node_modules/regenerator-runtime/runtime.js:95:21)\n```\n### After\n\n```\nTest.<anonymous> (error.js:40:5)\n```\n## \n\nDidn't include any test as the code is straightforward and manually tested to work, and we have other tests already confirming it's working.\n","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/1068/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/1068/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/avajs/ava/issues/461","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/461/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/461/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/461/events","html_url":"https://github.com/avajs/ava/pull/461","id":127842681,"node_id":"MDExOlB1bGxSZXF1ZXN0NTY3MDQwMTA=","number":461,"title":"Performance Improvements for files with thousands of tests","user":{"login":"jamestalmage","id":4082216,"node_id":"MDQ6VXNlcjQwODIyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/4082216?v=4","gravatar_id":"","url":"https://api.github.com/users/jamestalmage","html_url":"https://github.com/jamestalmage","followers_url":"https://api.github.com/users/jamestalmage/followers","following_url":"https://api.github.com/users/jamestalmage/following{/other_user}","gists_url":"https://api.github.com/users/jamestalmage/gists{/gist_id}","starred_url":"https://api.github.com/users/jamestalmage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamestalmage/subscriptions","organizations_url":"https://api.github.com/users/jamestalmage/orgs","repos_url":"https://api.github.com/users/jamestalmage/repos","events_url":"https://api.github.com/users/jamestalmage/events{/privacy}","received_events_url":"https://api.github.com/users/jamestalmage/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2016-01-21T04:29:49Z","updated_at":"2016-01-22T16:40:06Z","closed_at":"2016-01-21T23:22:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/461","html_url":"https://github.com/avajs/ava/pull/461","diff_url":"https://github.com/avajs/ava/pull/461.diff","patch_url":"https://github.com/avajs/ava/pull/461.patch","merged_at":"2016-01-21T23:22:16Z"},"body":"Using the [emoji-aware test-per-character branch](https://github.com/beaugunderson/emoji-aware/commit/e2c3a824ec6e28c2e86e9191fd7123cea8ac1e00) as a benchmark, and running `time ava`:\n\nmaster:\n\n```\n  4363 passed\n\nava  22.61s user 0.54s system 109% cpu 21.093 total\n```\n\nthis branch (only the `Runner` commits):\n\n```\n  4363 passed\n\nava  7.30s user 0.51s system 139% cpu 5.597 total\n```\n\nthis branch (all the commits):\n\n```\n  4363 passed\n\nava  6.32s user 0.46s system 145% cpu 4.675 total\n```\n\n---\n\nupdated benchmark (with empower-core performance tweaks):\n\n```\nava --verbose  5.05s user 0.32s system 138% cpu 3.872 total\n```\n","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/461/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/avajs/ava/issues/860","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/860/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/860/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/860/events","html_url":"https://github.com/avajs/ava/pull/860","id":156326675,"node_id":"MDExOlB1bGxSZXF1ZXN0NzEwOTA5ODY=","number":860,"title":"Pass shared caches to `globby`.","user":{"login":"jamestalmage","id":4082216,"node_id":"MDQ6VXNlcjQwODIyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/4082216?v=4","gravatar_id":"","url":"https://api.github.com/users/jamestalmage","html_url":"https://github.com/jamestalmage","followers_url":"https://api.github.com/users/jamestalmage/followers","following_url":"https://api.github.com/users/jamestalmage/following{/other_user}","gists_url":"https://api.github.com/users/jamestalmage/gists{/gist_id}","starred_url":"https://api.github.com/users/jamestalmage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamestalmage/subscriptions","organizations_url":"https://api.github.com/users/jamestalmage/orgs","repos_url":"https://api.github.com/users/jamestalmage/repos","events_url":"https://api.github.com/users/jamestalmage/events{/privacy}","received_events_url":"https://api.github.com/users/jamestalmage/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2016-05-23T17:51:19Z","updated_at":"2016-05-23T21:26:15Z","closed_at":"2016-05-23T21:26:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/860","html_url":"https://github.com/avajs/ava/pull/860","diff_url":"https://github.com/avajs/ava/pull/860.diff","patch_url":"https://github.com/avajs/ava/pull/860.patch","merged_at":"2016-05-23T21:26:15Z"},"body":"Improves globbing performance.\n\nFrom the [`node-glob` docs](https://github.com/isaacs/node-glob#options):\n\n> At the very least, you may pass in shared symlinks, statCache, realpathCache, and cache options, so that parallel glob operations will be sped up by sharing information about the filesystem.\n","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/860/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/avajs/ava/issues/276","repository_url":"https://api.github.com/repos/avajs/ava","labels_url":"https://api.github.com/repos/avajs/ava/issues/276/labels{/name}","comments_url":"https://api.github.com/repos/avajs/ava/issues/276/comments","events_url":"https://api.github.com/repos/avajs/ava/issues/276/events","html_url":"https://github.com/avajs/ava/pull/276","id":119129621,"node_id":"MDExOlB1bGxSZXF1ZXN0NTE5NTg5NzA=","number":276,"title":"Integrate time-require into the CLI.","user":{"login":"jamestalmage","id":4082216,"node_id":"MDQ6VXNlcjQwODIyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/4082216?v=4","gravatar_id":"","url":"https://api.github.com/users/jamestalmage","html_url":"https://github.com/jamestalmage","followers_url":"https://api.github.com/users/jamestalmage/followers","following_url":"https://api.github.com/users/jamestalmage/following{/other_user}","gists_url":"https://api.github.com/users/jamestalmage/gists{/gist_id}","starred_url":"https://api.github.com/users/jamestalmage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamestalmage/subscriptions","organizations_url":"https://api.github.com/users/jamestalmage/orgs","repos_url":"https://api.github.com/users/jamestalmage/repos","events_url":"https://api.github.com/users/jamestalmage/events{/privacy}","received_events_url":"https://api.github.com/users/jamestalmage/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2015-11-27T04:19:17Z","updated_at":"2015-11-27T06:37:46Z","closed_at":"2015-11-27T06:37:46Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/avajs/ava/pulls/276","html_url":"https://github.com/avajs/ava/pull/276","diff_url":"https://github.com/avajs/ava/pull/276.diff","patch_url":"https://github.com/avajs/ava/pull/276.patch","merged_at":"2015-11-27T06:37:46Z"},"body":"I want to start focusing on getting our require times down,\nboth in the main thread and forked tests.\n\nThis adds `time-require` support directly to the CLI to assist in that.\nThis is especially important for forked test processes, where I currently\nhave to manually add a line of code each time I want to test an optimization.\n\nI don't think this should be a publicly documented move. I think we want\nthe freedom to remove this once we are happy with performance.\n\nI have placed comments above all `time-require` references, indicating\nit is for internal use only. Users have been given fair warning against\nrelying on its inclusion long term.\n\nUsage:\n\n``` sh\n$ ./cli.js test/fixture/es2015.js --time-require --sorted\n```\n\n`--sorted` is optional. It sorts the requires from most expensive to least. The default is sequential sorting.\n\nThe output will display multiple `time-require` reports.\nOne for each forked process, and the last one for the main thread.\n","reactions":{"url":"https://api.github.com/repos/avajs/ava/issues/276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/avajs/ava/issues/276/timeline","performed_via_github_app":null,"state_reason":null,"score":1}]