[{"url":"https://api.github.com/repos/mochajs/mocha/issues/4839","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/4839/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/4839/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/4839/events","html_url":"https://github.com/mochajs/mocha/pull/4839","id":1155516002,"node_id":"PR_kwDOABYlWM4zvOpk","number":4839,"title":"Fix: potential call-stack crash when using 'dry-run' option","user":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"labels":[{"id":533082117,"node_id":"MDU6TGFiZWw1MzMwODIxMTc=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-patch","name":"semver-patch","color":"0e8a16","default":false,"description":"implementation requires increase of \"patch\" version number; \"bug fixes\""}],"state":"closed","locked":false,"assignee":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"assignees":[{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/60","html_url":"https://github.com/mochajs/mocha/milestone/60","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/60/labels","id":7694431,"node_id":"MI_kwDOABYlWM4AdWhf","number":60,"title":"v9.2.2","description":"","creator":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":3,"state":"closed","created_at":"2022-02-19T10:16:28Z","updated_at":"2022-03-11T17:10:31Z","due_on":null,"closed_at":"2022-03-11T17:10:12Z"},"comments":0,"created_at":"2022-03-01T16:01:26Z","updated_at":"2022-03-04T08:55:42Z","closed_at":"2022-03-04T08:26:24Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/4839","html_url":"https://github.com/mochajs/mocha/pull/4839","diff_url":"https://github.com/mochajs/mocha/pull/4839.diff","patch_url":"https://github.com/mochajs/mocha/pull/4839.patch","merged_at":"2022-03-04T08:26:24Z"},"body":"### Description\r\n\r\n`dry-run` mode: since the tests are not executed, but triggered only into an empty synchronous run, there is a potential risk of `RangeError: Maximum call stack size exceeded`.\r\n\r\n### Description of the Change\r\n\r\nFor each test we add an asynchronous function call with `Runner.immediately()`. We pay a slight performance costs for this which is insignificant in `dry-run` mode. \r\n\r\n### Applicable issues\r\n\r\ncloses #4838","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/4839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/4839/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/4638","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/4638/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/4638/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/4638/events","html_url":"https://github.com/mochajs/mocha/pull/4638","id":899704591,"node_id":"MDExOlB1bGxSZXF1ZXN0NjUxMzY5MTE4","number":4638,"title":"Limit the size of 'actual'/'expected' strings before generating a diff","user":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"labels":[{"id":184344,"node_id":"MDU6TGFiZWwxODQzNDQ=","url":"https://api.github.com/repos/mochajs/mocha/labels/confirmed-bug","name":"confirmed-bug","color":"A6340C","default":false,"description":"a defect, confirmed by a maintainer"},{"id":533081749,"node_id":"MDU6TGFiZWw1MzMwODE3NDk=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-major","name":"semver-major","color":"b60205","default":false,"description":"implementation requires increase of \"major\" version number; \"breaking changes\""},{"id":1268443804,"node_id":"MDU6TGFiZWwxMjY4NDQzODA0","url":"https://api.github.com/repos/mochajs/mocha/labels/performance","name":"performance","color":"ce9bef","default":false,"description":"Performance improvements"},{"id":2240305431,"node_id":"MDU6TGFiZWwyMjQwMzA1NDMx","url":"https://api.github.com/repos/mochajs/mocha/labels/dependencies","name":"dependencies","color":"0366d6","default":false,"description":"Pull requests that update a dependency file"}],"state":"closed","locked":false,"assignee":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"assignees":[{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/50","html_url":"https://github.com/mochajs/mocha/milestone/50","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/50/labels","id":6738358,"node_id":"MDk6TWlsZXN0b25lNjczODM1OA==","number":50,"title":"v9.0.0","description":"","creator":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":10,"state":"closed","created_at":"2021-05-07T18:56:14Z","updated_at":"2021-06-07T16:05:12Z","due_on":null,"closed_at":"2021-06-07T16:05:12Z"},"comments":1,"created_at":"2021-05-24T14:15:43Z","updated_at":"2021-10-07T15:19:49Z","closed_at":"2021-05-30T16:09:46Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/4638","html_url":"https://github.com/mochajs/mocha/pull/4638","diff_url":"https://github.com/mochajs/mocha/pull/4638.diff","patch_url":"https://github.com/mochajs/mocha/pull/4638.patch","merged_at":"2021-05-30T16:09:46Z"},"body":"### Description\r\n\r\nMocha prints its own diff on assertion errors by stringifying `err.actual` and `err.expected`, then passing both strings to [jsdiff](https://github.com/kpdecker/jsdiff) for generating a diff-patch. For big strings this synchronous process can take several minutes.\r\n\r\n_jsdiff_ has some known performance issues, so in mid-term we evtl. should evaluate a _jsdiff_ alternative.\r\nOn the other hand it's not a good idea to calculate a diff for two huge strings, even with a faster algorithm. We should limit the size of the input strings, as eg. done by Node's `assert` as well.\r\n\r\n### Description of the Change\r\n\r\n- no change: stringify `err.actual` and `err.expected`\r\n- new: when too big, truncate the resulting strings and add a message `... Lines skipped`\r\n\r\n\r\n### Applicable issues\r\n\r\ncloses #3675","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/4638/reactions","total_count":3,"+1":0,"-1":2,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/4638/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/4234","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/4234/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/4234/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/4234/events","html_url":"https://github.com/mochajs/mocha/pull/4234","id":604266287,"node_id":"MDExOlB1bGxSZXF1ZXN0NDA2ODkyNzUz","number":4234,"title":"Add ability to run tests in a mocha instance multiple times","user":{"login":"nicojs","id":1828233,"node_id":"MDQ6VXNlcjE4MjgyMzM=","avatar_url":"https://avatars.githubusercontent.com/u/1828233?v=4","gravatar_id":"","url":"https://api.github.com/users/nicojs","html_url":"https://github.com/nicojs","followers_url":"https://api.github.com/users/nicojs/followers","following_url":"https://api.github.com/users/nicojs/following{/other_user}","gists_url":"https://api.github.com/users/nicojs/gists{/gist_id}","starred_url":"https://api.github.com/users/nicojs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicojs/subscriptions","organizations_url":"https://api.github.com/users/nicojs/orgs","repos_url":"https://api.github.com/users/nicojs/repos","events_url":"https://api.github.com/users/nicojs/events{/privacy}","received_events_url":"https://api.github.com/users/nicojs/received_events","type":"User","site_admin":false},"labels":[{"id":185748,"node_id":"MDU6TGFiZWwxODU3NDg=","url":"https://api.github.com/repos/mochajs/mocha/labels/feature","name":"feature","color":"CC9264","default":false,"description":"enhancement proposal"},{"id":533082025,"node_id":"MDU6TGFiZWw1MzMwODIwMjU=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-minor","name":"semver-minor","color":"fbca04","default":false,"description":"implementation requires increase of \"minor\" version number; \"features\""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/39","html_url":"https://github.com/mochajs/mocha/milestone/39","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/39/labels","id":5349448,"node_id":"MDk6TWlsZXN0b25lNTM0OTQ0OA==","number":39,"title":"v7.2.0","description":"","creator":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":27,"state":"closed","created_at":"2020-04-26T06:39:15Z","updated_at":"2020-05-22T16:42:05Z","due_on":null,"closed_at":"2020-05-22T16:42:05Z"},"comments":39,"created_at":"2020-04-21T20:31:18Z","updated_at":"2020-10-26T22:54:24Z","closed_at":"2020-05-11T19:55:25Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/4234","html_url":"https://github.com/mochajs/mocha/pull/4234","diff_url":"https://github.com/mochajs/mocha/pull/4234.diff","patch_url":"https://github.com/mochajs/mocha/pull/4234.patch","merged_at":"2020-05-11T19:55:24Z"},"body":"### Description of the Change\r\n\r\nThese changes allow mocha to run multiple times with the same test suite programmatically (without reload). It does this with minimal code changes. \r\n\r\nIt also adds to validations, for when people call `mocha.run` at the wrong time.\r\n\r\nFor more details and reasoning, please see https://github.com/mochajs/mocha/issues/2783#issuecomment-616446938\r\n\r\nFixes #2783\r\n\r\n<!--\r\n\r\nWe must be able to understand the design of your change from this description. Keep in mind that the maintainers and/or community members reviewing this PR may not be familiar with the subsystem. Please be verbose.\r\n\r\n-->\r\n\r\n### Alternate Designs\r\n\r\nAlternatively, we could have totally removed all state from tests, suites and runnable, but we don't want to change the entire way of keeping state. Please see #2783 for the entire history. \r\n\r\n<!-- Explain what other alternates were considered and why the proposed version was selected -->\r\n\r\n### Why should this be in core?\r\n\r\nA lot of people seem interested in running a test suite multiple times without reloading files from disk. See #2783. I personally will use it to [implement mutation switching in Stryker](https://github.com/stryker-mutator/stryker/issues/1514)\r\n\r\n### Benefits\r\n\r\nHuge performance gain for my mutation testing use case. Other people have valid use cases as well.\r\n\r\n### Possible Drawbacks\r\n\r\nIt should be backward compatible, but since I had to rewrite parts in the core, I might have introduced undesired side effects ü§∑‚Äç‚ôÇÔ∏è. Although the integration test suite is awesome!\r\n<!-- What are the possible side-effects or negative impacts of the code change? -->\r\n\r\n### Applicable issues\r\n\r\n#2783 \r\n\r\n### Todo:\r\n\r\n- [x] Test: implement `reset`\r\n- [x] Suite: implement `reset`\r\n- [x] Runnable: implement `reset`\r\n- [x] Mocha: implement `dispose` and `cleanReferencesAfterRun`\r\n- [x] Mocha: throw errors when `run` call is invalid.\r\n- [x] Runner: make sure to not leak event listeners.\r\n- [x] Runner: implement `dispose` and `cleanReferencesAfterRun`\r\n- [x] Unit tests\r\n- [x] Integration tests\r\n- [x] Docs","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/4234/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/4234/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/4319","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/4319/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/4319/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/4319/events","html_url":"https://github.com/mochajs/mocha/pull/4319","id":634984142,"node_id":"MDExOlB1bGxSZXF1ZXN0NDMxNDM3MDE1","number":4319,"title":"disable parallel mode by default","user":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"labels":[{"id":125688233,"node_id":"MDU6TGFiZWwxMjU2ODgyMzM=","url":"https://api.github.com/repos/mochajs/mocha/labels/chore","name":"chore","color":"7F7165","default":false,"description":"generally involving deps, tooling, configuration, etc."},{"id":533082117,"node_id":"MDU6TGFiZWw1MzMwODIxMTc=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-patch","name":"semver-patch","color":"0e8a16","default":false,"description":"implementation requires increase of \"patch\" version number; \"bug fixes\""}],"state":"closed","locked":false,"assignee":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"assignees":[{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/35","html_url":"https://github.com/mochajs/mocha/milestone/35","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/35/labels","id":4981046,"node_id":"MDk6TWlsZXN0b25lNDk4MTA0Ng==","number":35,"title":"v8.0.0","description":"","creator":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":23,"state":"closed","created_at":"2020-01-07T08:28:16Z","updated_at":"2020-06-12T19:58:41Z","due_on":null,"closed_at":"2020-06-12T19:58:41Z"},"comments":1,"created_at":"2020-06-08T22:49:57Z","updated_at":"2020-06-09T18:16:53Z","closed_at":"2020-06-09T18:16:47Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/4319","html_url":"https://github.com/mochajs/mocha/pull/4319","diff_url":"https://github.com/mochajs/mocha/pull/4319.diff","patch_url":"https://github.com/mochajs/mocha/pull/4319.patch","merged_at":"2020-06-09T18:16:47Z"},"body":"Having run benchmarks against our unit tests and integration tests, I've found that the unit tests do not benefit from parallel mode--and in fact, they run more slowly.  Integration tests still see a 50% performance boost, so we will use parallel tests for those only.\r\n","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/4319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/4319/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/4245","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/4245/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/4245/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/4245/events","html_url":"https://github.com/mochajs/mocha/pull/4245","id":604292174,"node_id":"MDExOlB1bGxSZXF1ZXN0NDA2OTE0MDkw","number":4245,"title":"add support for running tests in parallel","user":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"labels":[{"id":185748,"node_id":"MDU6TGFiZWwxODU3NDg=","url":"https://api.github.com/repos/mochajs/mocha/labels/feature","name":"feature","color":"CC9264","default":false,"description":"enhancement proposal"},{"id":533082025,"node_id":"MDU6TGFiZWw1MzMwODIwMjU=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-minor","name":"semver-minor","color":"fbca04","default":false,"description":"implementation requires increase of \"minor\" version number; \"features\""},{"id":810207725,"node_id":"MDU6TGFiZWw4MTAyMDc3MjU=","url":"https://api.github.com/repos/mochajs/mocha/labels/node.js","name":"node.js","color":"75b406","default":false,"description":"command-line-or-Node.js-specific"}],"state":"closed","locked":false,"assignee":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"assignees":[{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/35","html_url":"https://github.com/mochajs/mocha/milestone/35","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/35/labels","id":4981046,"node_id":"MDk6TWlsZXN0b25lNDk4MTA0Ng==","number":35,"title":"v8.0.0","description":"","creator":{"login":"juergba","id":44573692,"node_id":"MDQ6VXNlcjQ0NTczNjky","avatar_url":"https://avatars.githubusercontent.com/u/44573692?v=4","gravatar_id":"","url":"https://api.github.com/users/juergba","html_url":"https://github.com/juergba","followers_url":"https://api.github.com/users/juergba/followers","following_url":"https://api.github.com/users/juergba/following{/other_user}","gists_url":"https://api.github.com/users/juergba/gists{/gist_id}","starred_url":"https://api.github.com/users/juergba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/juergba/subscriptions","organizations_url":"https://api.github.com/users/juergba/orgs","repos_url":"https://api.github.com/users/juergba/repos","events_url":"https://api.github.com/users/juergba/events{/privacy}","received_events_url":"https://api.github.com/users/juergba/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":23,"state":"closed","created_at":"2020-01-07T08:28:16Z","updated_at":"2020-06-12T19:58:41Z","due_on":null,"closed_at":"2020-06-12T19:58:41Z"},"comments":17,"created_at":"2020-04-21T21:17:53Z","updated_at":"2020-06-10T21:45:01Z","closed_at":"2020-06-01T21:19:39Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/4245","html_url":"https://github.com/mochajs/mocha/pull/4245","diff_url":"https://github.com/mochajs/mocha/pull/4245.diff","patch_url":"https://github.com/mochajs/mocha/pull/4245.patch","merged_at":"2020-06-01T21:19:38Z"},"body":"> (this PR depends on most other PRs linked to #4198, so they should be merged first; documentation will be in another PR)\r\n\r\n## Summary\r\n\r\nThis PR adds support for running test files in parallel via `--parallel`.  For many cases, this should \"just work.\"\r\n\r\n## How It Works\r\n\r\nWhen the `--parallel` flag is supplied, Mocha will swap out the default `Runner` (`lib/runner.js`) for `BufferedRunner` (`lib/buffered-runner.js`).\r\n\r\n`BufferedRunner` _extends_ `Runner`.  `BufferedRunner#run()` is the main point of extension.  Instead of executing the tests in serial, it will create a pool of worker processes (not worker _threads_) based on the maximum job count (`--jobs`; defaults to `<number of CPU cores> - 1`).  Both `BufferedRunner` and the `worker` module consume the abstraction layer, [workerpool](https://npm.im/workerpool).\r\n\r\n`BufferedRunner#run()` does _not_ load the test files, unlike `Runner#run()`.  Instead, it has a list of test files, and puts these into an async queue.  The `EVENT_RUN_BEGIN` event is then emitted.  As files enter the queue, `BufferedRunner#run()` tells `workerpool` to execute the `run()` function of the pool.  `workerpool` then launches as many worker processes are needed--up to the maximum--and executes the `run()` function with a single filepath and any options for a `Mocha` instance.\r\n\r\nThe first time `lib/worker.js` is invoked, it will \"bootstrap\" itself, by handling `--require`'d modules and validating the UI.  Note that _reporter validation_ does not occur.  Once bootstrapped, it instantiate `Mocha`, add the single file, swap any reporter out for the `Buffered` reporter (`lib/reporters/buffered.js`) then execute `Mocha#run()`, which invokes `Runner#run()`.\r\n\r\nThe `Buffered` reporter listens for events emitting from the `Runner` instance, like a reporter usually does.  But instead of outputting to the console, it buffers the events in a queue.  Once the file has completed running, the queue is drained: the events collected are (trivially) serialized for transmission back to the main process.  `BufferedRunner#run()` receives the list of events, trivially _deserializes_ them, and re-emits the events to whatever the chosen reporter is (e.g., the `spec` reporter).  In this way, the reporters don't know that the tests were run in parallel.  Practically, the user will see reporter output in \"chunks\" instead of the \"stream\" of results they usually expect.  This method ensures that while the test files run in a nondeterministic order, the reporter output will be deterministic for any given test file.\r\n\r\nOnce the result (the queue of events) has been returned to the main process, the worker process stays open, but waits for further instruction.  If there are more files in `BufferedRunner#run()`'s queue, `workerpool` will instruct the worker to take the next file from the list, and so on, and so forth.  When all files have executed, the pool terminates, the `EVENT_RUN_END` event is emitted, and the reporter handles it.\r\n\r\n## Limitations & Caveats\r\n\r\n> (this section is pasted from the documentation with minimal edits)\r\n\r\n### Reporter Limitations\r\n\r\nDue to the nature of the following reporters, they cannot work when running tests in parallel:\r\n\r\n- `markdown`\r\n- `progress`\r\n- `json-stream`\r\n\r\nThese reporters expect Mocha to know _how many tests it plans to run_ before execution. This information is unavailable in parallel mode, as test files are loaded only when they are about to be run.\r\n\r\nIn serial mode, tests results will \"stream\" as they occur. In parallel mode, reporter output is _buffered_; reporting will occur after each file is completed. In practice, the reporter output will appear in \"chunks\" (but will otherwise be identical).\r\n\r\n### Order is Non-Deterministic\r\n\r\nIn parallel mode, we have no guarantees about the order in which test files will be run--or what process runs them--as it depends on the execution times of the test files.\r\n\r\nBecause of this, the following options _cannot be used_ in parallel mode:\r\n\r\n- `--file`\r\n- `--sort`\r\n- `--delay`\r\n\r\n### Test Duration Variability\r\n\r\nBecause running tests in parallel mode uses more system resources at once, the OS may take extra time to schedule and complete some operations. For this reason, test timeouts may need to be increased either globally or otherwise.\r\n\r\n### \"Bail\" is \"Best Effort\"\r\n\r\nWhen used with `--bail` (or `this.bail()`) to exit after the first failure, it's likely other tests will be running at the same time. Mocha must shut down its worker processes before exiting.\r\n\r\nLikewise, subprocesses may throw uncaught exceptions. When used with `--allow-uncaught`, Mocha will \"bubble\" this exception to the main process, but still must shut down its processes.\r\n\r\n### Root Hooks Are Not Global\r\n\r\n> _NOTE: This only applies to test files run parallel mode_.\r\n\r\nA root-level hook is a hook in a test file which is _not defined_ within a suite. An example using the `bdd` interface:\r\n\r\n```js\r\n// test/setup.js\r\nbeforeEach(function() {\r\n  doMySetup();\r\n});\r\n\r\nafterEach(function() {\r\n  doMyTeardown();\r\n});\r\n```\r\n\r\nWhen run (in the default \"serial\" mode) via `mocha --file \"./test/setup.js\" \"./test/**/*.spec.js\"`, `setup.js` will be executed _first_, and install the two hooks shown above for every test found in `./test/**/*.spec.js`.\r\n\r\n**When Mocha runs in parallel mode, test files do not share the same process.** Consequently, a root-level hook defined in test file _A_ won't be present in test file _B_.\r\n\r\nThere are a (minimum of) two workarounds for this:\r\n\r\n1. `require('./setup.js')` or `import './setup.js'` at the top of every test file. Best avoided for those averse to boilerplate.\r\n1. _Recommended_: Define root-level hooks in a required file, using the new (also as of VERSION) Root Hook Plugin system.\r\n\r\n### No Browser Support\r\n\r\nParallel mode is only available in Node.js.\r\n\r\n### Migration Checklist\r\n\r\nIf you find your tests don't work properly when run with `--parallel`, either shrug and move on, or use this handy-dandy checklist to get things working:\r\n\r\n- :white_check_mark: Ensure you are using a supported reporter.\r\n- :white_check_mark: Ensure you are not using other unsupported flags.\r\n- :white_check_mark: Double-check your config file; options set in config files will be merged with any command-line option.\r\n- :white_check_mark: Look for root-level hooks in your tests. Move them into a root hook plugin.\r\n- :white_check_mark: Do any assertion, mock, or other test libraries you're consuming use root hooks? They may need to be migrated for compatibility with parallel mode.\r\n- :white_check_mark: If tests are unexpectedly timing out, you may need to increase the default test timeout (via `--timeout`)\r\n- :white_check_mark: Ensure your tests do not depend on being run in a specific order.\r\n- :white_check_mark: Ensure your tests clean up after themselves; remove temp files, handles, sockets, etc. Don't try to share state or resources between test files.\r\n\r\n### Caveats About Testing in Parallel\r\n\r\nSome types of tests are _not_ so well-suited to run in parallel. For example, extremely timing-sensitive tests, or tests which make I/O requests to a limited pool of resources (such as opening ports, or automating browser windows, hitting a test DB, or remote server, etc.).\r\n\r\nFree-tier butt CI services may not provide a suitable multi-core container or VM for their build agents. Regarding expected performance gains in CI: your mileage may vary. It may help to use a conditional in a `.mocharc.js` to check for `process.env.CI`, and adjust the job count as appropriate.\r\n\r\nIt's unlikely (but not impossible) to see a performance gain from a job count _greater than_ the number of available CPU cores. That said, _play around with the job count_--there's no one-size-fits all, and the unique characteristics of your tests will determine the optimal number of jobs; it may even be that fewer is faster!\r\n\r\n## Changeset Notes\r\n\r\n- updated signal handling in `bin/mocha` to a) better work with Windows, and b) work properly with `--parallel` to avoid leaving zombie workers\r\n- docstrings in `lib/cli/collect-files.js`\r\n- refactors in `lib/cli/run-helpers.js` and `lib/cli/watch-run.js`.  We now have four methods:\r\n    - `watchRun()` - serial + watch\r\n    - `singleRun()` - serial\r\n    - `parallelWatchRun()` - parallel + watch\r\n    - `parallelRun()` - parallel\r\n- `lib/cli/run.js` and `lib/cli/run-option-metadata.js`: additions for new options and checks for incompatibility\r\n- add `lib/reporters/buffered.js` (`Buffered`); this reporter is _not_ re-exported in `Mocha.reporters`, since it should only be invoked internally.\r\n- tweak `landing` reporter to avoid referencing `Runner#total`, which is incompatible with parallel mode.  It didn't need to do so in the first place!\r\n- the `tap` reporter now outputs the plan at the _end_ instead of at the beginning (avoiding a call to `Runner#grepTotal()`, which is incompatible with parallel mode).  This is within spec, so should not be a breaking change.\r\n- add `lib/buffered-runner.js` (`BufferedRunner`); subclass of `Runner` which overrides the `run()` method.\r\n    - There's a little custom finite state machine in here.  didn't want to pull in a third-party module, but we should consider doing so if we use FSM's elsewhere.\r\n    - when `DEBUG=mocha:parallel*` is in the env, this module will output statistics about the worker pool every 5s\r\n    - the `run()` method looks a little weird because I wanted to use `async/await`, but the method it is overriding (`Runner#run`) is _not_ `async`\r\n    - traps `SIGINT` to gracefully terminate the pool\r\n    - pulls in [promise.allsettled](https://npm.im/promise.allsettled) polyfill to handle workers that may have rejected with uncaught exceptions\r\n    - \"bail\" support is best-effort.\r\n    - the `ABORTING` state is only for interruption via `SIGINT` or if `allowUncaught` is true and we get an uncaught exception\r\n- `Hook`, `Suite`, `Test`: add a `serialize()` method.  This pulls out the most relevant information about the object for transmission over IPC.  It's called by worker processes for each event received by its `Runner`; event arguments (e.g., `test` or `suite`) are serialized in this manner.  Note that this _limits what reporters have access to_, which may break compatibility with third-party reporters that may use information that is missing from the serialized object.  As those cases arise, we can add more information to the serialized objects (in some cases).  The `$$` convention tells the _deserializer_ to turn the property into a function which returns the passed value, e.g., `test.fullTitle()`.\r\n- `lib/mocha.js`:\r\n    - refactor `Mocha#reporter` for nicer parameter & variable names\r\n    - rename `loadAsync` to `lazyLoadFiles`, which is more descriptive, IMO.  It's a private property, so should not be a breaking change.\r\n    - Constructor will dynamically choose the appropriate `Runner`\r\n- `lib/runner.js`: `BufferedRunner` needs the options from `Mocha#options`, so I updated the parent method to define the parameter.  It is unused here.\r\n- add `lib/serializer.js`: on the worker process side, manages event queue serialization; manages deserialization of the event queue in the main process.\r\n    - I spent a long time trying to get this working.  We need to account for things like `Error` instances, with their stack traces, since those can be event arguments (e.g., `EVENT_TEST_FAIL` sends both a `Test` and the `Error`).  It's impossible to serialize circular (self-referential) objects, so we need to account for those as well.\r\n    - Not super happy with the deserialization algorithm, since it's recursive, but it shouldn't be too much of an issue because the serializer won't output circular structures.\r\n    - Attempted to avoid prototype pollution issues\r\n    - Much of this works by mutating objects, mostly because it can be more performant.  The code can be changed to be \"more immutable\", as that's likely to be easier to understand, if it doesn't impact performance too much.  We're serializing potentially very large arrays of stuff.\r\n    - The `__type` prop is a hint for the deserializer.  This convention allows us to re-expand plain objects back into `Error` instances, for example.  You can't send an `Error` instance over IPC!\r\n- add `lib/worker.js`:\r\n    - registers its `run()` function with `workerpool` to be called by main process\r\n    - if `DEBUG=mocha:parallel*` is set, will output information (on an interval) about long-running test files\r\n    - afaik the only way `run()` can reject is if `allowUncaught` is true or serialization fails\r\n    - any user-supplied `reporter` value is replaced with the `Buffered` reporter.  thus, reporters are not validated.\r\n    - the worker uses `Runner`, like usual.\r\n- tests:\r\n    - see `test/integration/options/parallel.spec.js` for the interesting stuff\r\n    - upgrade `unexpected` for \"to have readonly property\" assertion\r\n    - upgrade `unexpected-eventemitter` for support async function support\r\n    - integration test helpers allow Mocha's developers to use `--bail` and `--parallel`, but will default to `--no-bail` and `--no-parallel`.\r\n- etc:\r\n    - update `.eslintrc.yml` for new Node-only files\r\n    - increase default timeout to `1000` (also seen in another PR) and use `parallel` mode by default in `.mocharc.yml`\r\n    - run node unit tests _in serial_ as sort of a smoke test, as otherwise all our tests would be run in parallel\r\n    - karma, browserify: ignore files for parallel support\r\n    - force color output in CI. this is nice on travis, but ugly on appveyor.  either way, it's easier to read than having no color\r\n\r\nRef: #4198\r\n\r\n","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/4245/reactions","total_count":8,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":1,"eyes":1},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/4245/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/3686","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/3686/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/3686/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/3686/events","html_url":"https://github.com/mochajs/mocha/pull/3686","id":402525367,"node_id":"MDExOlB1bGxSZXF1ZXN0MjQ3MTg5MzI0","number":3686,"title":"fix regex in utils.stackTraceFilter to prevent ReDoS #3416","user":{"login":"cyjake","id":252317,"node_id":"MDQ6VXNlcjI1MjMxNw==","avatar_url":"https://avatars.githubusercontent.com/u/252317?v=4","gravatar_id":"","url":"https://api.github.com/users/cyjake","html_url":"https://github.com/cyjake","followers_url":"https://api.github.com/users/cyjake/followers","following_url":"https://api.github.com/users/cyjake/following{/other_user}","gists_url":"https://api.github.com/users/cyjake/gists{/gist_id}","starred_url":"https://api.github.com/users/cyjake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cyjake/subscriptions","organizations_url":"https://api.github.com/users/cyjake/orgs","repos_url":"https://api.github.com/users/cyjake/repos","events_url":"https://api.github.com/users/cyjake/events{/privacy}","received_events_url":"https://api.github.com/users/cyjake/received_events","type":"User","site_admin":false},"labels":[{"id":533082117,"node_id":"MDU6TGFiZWw1MzMwODIxMTc=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-patch","name":"semver-patch","color":"0e8a16","default":false,"description":"implementation requires increase of \"patch\" version number; \"bug fixes\""},{"id":618785682,"node_id":"MDU6TGFiZWw2MTg3ODU2ODI=","url":"https://api.github.com/repos/mochajs/mocha/labels/security","name":"security","color":"8F3127","default":false,"description":"involving vulnerabilities"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/19","html_url":"https://github.com/mochajs/mocha/milestone/19","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/19/labels","id":3210785,"node_id":"MDk6TWlsZXN0b25lMzIxMDc4NQ==","number":19,"title":"v6.0.0","description":"","creator":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":123,"state":"closed","created_at":"2018-03-22T22:51:15Z","updated_at":"2019-02-18T21:14:19Z","due_on":null,"closed_at":"2019-02-18T21:14:19Z"},"comments":7,"created_at":"2019-01-24T03:22:25Z","updated_at":"2019-01-30T17:56:31Z","closed_at":"2019-01-30T17:56:31Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/3686","html_url":"https://github.com/mochajs/mocha/pull/3686","diff_url":"https://github.com/mochajs/mocha/pull/3686.diff","patch_url":"https://github.com/mochajs/mocha/pull/3686.patch","merged_at":"2019-01-30T17:56:31Z"},"body":"if the stack trace begins with a large error message (>= 20k charactors), and user leaves `--full-trace` disabled, `utils.stackTraceFilter()` takes ages to finish. Large error messages is quite possible when user makes containment assertions such as `expect(content).to.contain(word)`.\r\n\r\n### Description of the Change\r\n\r\nsimplified the regex used in `utils.stackTraceFilter()` to boost performance therefore prevent ReDoS if the stack contains large error message.\r\n\r\n### Alternate Designs\r\n\r\nIt's possible to skip check error message in stack by skipping the first line but the regex fix won't change any behavior hence it is chosen.\r\n\r\n### Why should this be in core?\r\n\r\nwell, it's a bug introduced by the stack filtering feature.\r\n\r\n### Benefits\r\n\r\nmocha won't hang even if users make assertions with large error messages, which is quite possible because containment check is used a lot.\r\n\r\n### Possible Drawbacks\r\n\r\nNone\r\n\r\n### Applicable issues\r\n\r\n#3416 looks like one but it was because of an external library (still quite possible if chai makes large error message and `assert.deepEqual` don't, didn't check).\r\n","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/3686/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/3686/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/3310","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/3310/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/3310/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/3310/events","html_url":"https://github.com/mochajs/mocha/pull/3310","id":311347872,"node_id":"MDExOlB1bGxSZXF1ZXN0MTc5NDc5NTQ3","number":3310,"title":"improve caching performance in CI","user":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"labels":[{"id":400124903,"node_id":"MDU6TGFiZWw0MDAxMjQ5MDM=","url":"https://api.github.com/repos/mochajs/mocha/labels/qa","name":"qa","color":"996516","default":false,"description":"involving Mocha's tests, coverage, or CI config"},{"id":533082117,"node_id":"MDU6TGFiZWw1MzMwODIxMTc=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-patch","name":"semver-patch","color":"0e8a16","default":false,"description":"implementation requires increase of \"patch\" version number; \"bug fixes\""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/20","html_url":"https://github.com/mochajs/mocha/milestone/20","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/20/labels","id":3233173,"node_id":"MDk6TWlsZXN0b25lMzIzMzE3Mw==","number":20,"title":"v5.1.0","description":"","creator":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":13,"state":"closed","created_at":"2018-04-01T04:42:36Z","updated_at":"2018-04-18T16:29:14Z","due_on":null,"closed_at":"2018-04-18T16:29:14Z"},"comments":2,"created_at":"2018-04-04T18:48:54Z","updated_at":"2018-04-07T16:55:38Z","closed_at":"2018-04-05T03:13:23Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/3310","html_url":"https://github.com/mochajs/mocha/pull/3310","diff_url":"https://github.com/mochajs/mocha/pull/3310.diff","patch_url":"https://github.com/mochajs/mocha/pull/3310.patch","merged_at":"2018-04-05T03:13:23Z"},"body":"This change \"warms up\"  the npm caches for Node.js 9 jobs, since it will be reused during the build.  It re-enables caching for Node.js 8, 6 and 4, since I RTFM'd more closely. üò¨ \r\n\r\nFrom the Travis-CI [docs](https://docs.travis-ci.com/user/caching):\r\n\r\n> There is one cache per branch and language version/ compiler version/ JDK version/ Gemfile location/ etc.\r\n\r\n1. for the smoke tests, we do a *production only* install per node.js version.  we do NOT want to cache `node_modules` or `~/.npm`, since it should always reflect what a user would get.\r\n1. we warm up the cache; basically this runs a *full* `npm install` for node.js 9 with *no global environment variables*\r\n1. we lint, using the warmed-up cache\r\n1. tests:\r\n  - we run node.js tests in 9 *and* browser tests using the warmed-up cache\r\n  - we run node.js tests in v6 and v4 using a `node_modules`-only cache.  these are *not* reused during the build (unlike the node 9 caches), but may be reused during subsequent builds against the same branch.\r\n","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/3310/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/3310/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/3187","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/3187/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/3187/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/3187/events","html_url":"https://github.com/mochajs/mocha/pull/3187","id":285422535,"node_id":"MDExOlB1bGxSZXF1ZXN0MTYwNzIxMzQ1","number":3187,"title":"Ensure consistent calculation of duration","user":{"login":"FND","id":3515,"node_id":"MDQ6VXNlcjM1MTU=","avatar_url":"https://avatars.githubusercontent.com/u/3515?v=4","gravatar_id":"","url":"https://api.github.com/users/FND","html_url":"https://github.com/FND","followers_url":"https://api.github.com/users/FND/followers","following_url":"https://api.github.com/users/FND/following{/other_user}","gists_url":"https://api.github.com/users/FND/gists{/gist_id}","starred_url":"https://api.github.com/users/FND/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FND/subscriptions","organizations_url":"https://api.github.com/users/FND/orgs","repos_url":"https://api.github.com/users/FND/repos","events_url":"https://api.github.com/users/FND/events{/privacy}","received_events_url":"https://api.github.com/users/FND/received_events","type":"User","site_admin":false},"labels":[{"id":184344,"node_id":"MDU6TGFiZWwxODQzNDQ=","url":"https://api.github.com/repos/mochajs/mocha/labels/confirmed-bug","name":"confirmed-bug","color":"A6340C","default":false,"description":"a defect, confirmed by a maintainer"},{"id":533082117,"node_id":"MDU6TGFiZWw1MzMwODIxMTc=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-patch","name":"semver-patch","color":"0e8a16","default":false,"description":"implementation requires increase of \"patch\" version number; \"bug fixes\""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/13","html_url":"https://github.com/mochajs/mocha/milestone/13","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/13/labels","id":3004049,"node_id":"MDk6TWlsZXN0b25lMzAwNDA0OQ==","number":13,"title":"v5.0.0","description":"This is a placeholder for the next Mocha release (v5.0.0)","creator":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":15,"state":"closed","created_at":"2017-12-29T21:19:41Z","updated_at":"2018-01-28T04:47:38Z","due_on":null,"closed_at":"2018-01-28T04:47:38Z"},"comments":3,"created_at":"2018-01-02T12:51:40Z","updated_at":"2018-01-03T08:21:23Z","closed_at":"2018-01-02T23:31:56Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/3187","html_url":"https://github.com/mochajs/mocha/pull/3187","diff_url":"https://github.com/mochajs/mocha/pull/3187.diff","patch_url":"https://github.com/mochajs/mocha/pull/3187.patch","merged_at":"2018-01-02T23:31:56Z"},"body":"### Description of the Change\r\n\r\nminor adjustment; probably doesn't make much of a difference, but seems more correct this way\r\n\r\n### Alternate Designs\r\n\r\nN/A\r\n\r\n### Why should this be in core?\r\n\r\nN/A\r\n\r\n### Benefits\r\n\r\n* minor performance enhancement\r\n* slightly more consistent reporting\r\n\r\n### Possible Drawbacks\r\n\r\nnone, I hope\r\n\r\n### Applicable issues\r\n\r\nN/A\r\n","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/3187/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/3187/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/3170","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/3170/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/3170/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/3170/events","html_url":"https://github.com/mochajs/mocha/pull/3170","id":283728911,"node_id":"MDExOlB1bGxSZXF1ZXN0MTU5NTQzNjY1","number":3170,"title":"Optimize documentation load speed and move to Netlify","user":{"login":"Munter","id":331790,"node_id":"MDQ6VXNlcjMzMTc5MA==","avatar_url":"https://avatars.githubusercontent.com/u/331790?v=4","gravatar_id":"","url":"https://api.github.com/users/Munter","html_url":"https://github.com/Munter","followers_url":"https://api.github.com/users/Munter/followers","following_url":"https://api.github.com/users/Munter/following{/other_user}","gists_url":"https://api.github.com/users/Munter/gists{/gist_id}","starred_url":"https://api.github.com/users/Munter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Munter/subscriptions","organizations_url":"https://api.github.com/users/Munter/orgs","repos_url":"https://api.github.com/users/Munter/repos","events_url":"https://api.github.com/users/Munter/events{/privacy}","received_events_url":"https://api.github.com/users/Munter/received_events","type":"User","site_admin":false},"labels":[{"id":124575169,"node_id":"MDU6TGFiZWwxMjQ1NzUxNjk=","url":"https://api.github.com/repos/mochajs/mocha/labels/documentation","name":"documentation","color":"825d40","default":true,"description":"anything involving docs or mochajs.org"},{"id":533082117,"node_id":"MDU6TGFiZWw1MzMwODIxMTc=","url":"https://api.github.com/repos/mochajs/mocha/labels/semver-patch","name":"semver-patch","color":"0e8a16","default":false,"description":"implementation requires increase of \"patch\" version number; \"bug fixes\""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/mochajs/mocha/milestones/11","html_url":"https://github.com/mochajs/mocha/milestone/11","labels_url":"https://api.github.com/repos/mochajs/mocha/milestones/11/labels","id":3003203,"node_id":"MDk6TWlsZXN0b25lMzAwMzIwMw==","number":11,"title":"v4.1.0","description":"","creator":{"login":"boneskull","id":924465,"node_id":"MDQ6VXNlcjkyNDQ2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/924465?v=4","gravatar_id":"","url":"https://api.github.com/users/boneskull","html_url":"https://github.com/boneskull","followers_url":"https://api.github.com/users/boneskull/followers","following_url":"https://api.github.com/users/boneskull/following{/other_user}","gists_url":"https://api.github.com/users/boneskull/gists{/gist_id}","starred_url":"https://api.github.com/users/boneskull/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boneskull/subscriptions","organizations_url":"https://api.github.com/users/boneskull/orgs","repos_url":"https://api.github.com/users/boneskull/repos","events_url":"https://api.github.com/users/boneskull/events{/privacy}","received_events_url":"https://api.github.com/users/boneskull/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":27,"state":"closed","created_at":"2017-12-29T03:38:09Z","updated_at":"2017-12-29T21:18:10Z","due_on":null,"closed_at":"2017-12-29T21:18:10Z"},"comments":8,"created_at":"2017-12-20T23:39:31Z","updated_at":"2017-12-29T04:01:28Z","closed_at":"2017-12-22T06:54:04Z","author_association":"MEMBER","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/3170","html_url":"https://github.com/mochajs/mocha/pull/3170","diff_url":"https://github.com/mochajs/mocha/pull/3170.diff","patch_url":"https://github.com/mochajs/mocha/pull/3170.patch","merged_at":"2017-12-22T06:54:03Z"},"body":"This ended up being slightly bigger than I first anticipated\r\n\r\n## Move to netlify\r\n\r\nNetlify lets us run our own build system and control out own http headers. This means we can take advantage of automated bundling and image processing pipelines and serve our assets in a more optimal fashion\r\n\r\nNetlify will do a build of all pull requests, which means we'll have the ability to preview changes to the documentation and get it speed tested before we merge a PR.\r\n\r\n## Build system\r\n\r\nI have added another build step after `jekyll`. Now `assetgraph-builder` runs a post-optimization of the jekyll artefacts and places the optimized build in `docs/_dist`, which netlify serves.\r\n\r\nAssetgraph-builder doesn't require much in changes to the code. In fact the only real changes to the code is where I took advantage of the image pipeline to resize some images and compress them better.\r\n\r\nI also adjusted the build system to inline some images that are smaller then ~10kb. This was in order to get the svg logo inlined, but had the side effect of also inlining some screenshots. What exactly gets inlined might be something we should revisit again.\r\n\r\n`Assetgraph-builder` has some optional dependencies for image optimizations that might fails installation on local machines unless some prerequisites have been installed. Installation instructions fr if you want to run a full local build can be found here: https://github.com/assetgraph/assetgraph-builder#installation\r\n\r\n\r\n## Performance optimizations\r\n\r\nThe build system now scales content screenshots down to the maximum width of the page and I have added pallette reductions on the heavier ones. This yielded around **600kb size reduction**\r\n\r\nThe Opencollect avatars where extremely inefficient in their payload. They were serving base64 inlined unoptimized images inside an svg file. I read up on their api source code and switched over to request avatars in a way that **reduced the payload by another 550kb**\r\n\r\nSwitched Opencollect images over to be https only, which takes advantage of them using h2.\r\n\r\nReduced the amount of sponsors to show from open collect. We were just fetching the same 1px image after a redirect for each of the missing sponsor slots\r\n\r\nI added general losssless compression on all images which yielded probably another **150kb reduction**\r\n\r\nI moved most CDN loaded assets to the local project. They are now bundled with the other css and javascript assets, which reduces the blocking of the page while an external CDN is being requested from.\r\n\r\nMoved CSS to the top and js to the bottom of the page. Async load all js.\r\n\r\nRemoved the js loading switch for the logo and tagline. Now a pure css animation.\r\n\r\nRemoved the js loading switch from the opencollect backers. Their avatar sizes are known up front, so the images can be shown without the page jumping. Added a fallback avatar as background while real avatars load\r\n\r\nAdded preconnect hints for known external domains.\r\n\r\nAdded content addressable asset naming and far future expiration cache headers for optimized reload.\r\n\r\n## Other changes\r\n\r\n- Made some slight changes to the outer page scaffold to better accommodate mobile devices\r\n- Changes `http:` URLs to `https:` where possible\r\n\r\n## Speed improvements\r\n\r\nInitial paint time of the page has been drastically decreased. On slow mobile connections by more than half, and the full page loads much faster as well.\r\n\r\nHere are comparisons before and after on a Moto4G chrome browser on a slow 3G connection:\r\n\r\n![image](https://user-images.githubusercontent.com/331790/34233698-470ff41c-e5e7-11e7-9c46-855279a3ba72.png)\r\n\r\n![image](https://user-images.githubusercontent.com/331790/34233712-528d66ee-e5e7-11e7-8601-755529c204db.png)\r\n\r\n![image](https://user-images.githubusercontent.com/331790/34233730-635fc2dc-e5e7-11e7-9418-a1c3278de7a3.png)\r\n\r\nhttps://www.webpagetest.org/video/compare.php?tests=171218_G6_08d1b205c2a90d88f488347c47d49dee%2C171220_AZ_66f4eb3fa9c3b2d40e39d1735d1200f6&thumbSize=200&ival=500&end=full","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/3170/reactions","total_count":3,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/3170/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/701","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/701/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/701/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/701/events","html_url":"https://github.com/mochajs/mocha/pull/701","id":9712449,"node_id":"MDExOlB1bGxSZXF1ZXN0MzU2MDkyMg==","number":701,"title":"Add instanceof check for inheriting from Error","user":{"login":"gregrperkins","id":329371,"node_id":"MDQ6VXNlcjMyOTM3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/329371?v=4","gravatar_id":"","url":"https://api.github.com/users/gregrperkins","html_url":"https://github.com/gregrperkins","followers_url":"https://api.github.com/users/gregrperkins/followers","following_url":"https://api.github.com/users/gregrperkins/following{/other_user}","gists_url":"https://api.github.com/users/gregrperkins/gists{/gist_id}","starred_url":"https://api.github.com/users/gregrperkins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gregrperkins/subscriptions","organizations_url":"https://api.github.com/users/gregrperkins/orgs","repos_url":"https://api.github.com/users/gregrperkins/repos","events_url":"https://api.github.com/users/gregrperkins/events{/privacy}","received_events_url":"https://api.github.com/users/gregrperkins/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2013-01-06T02:59:27Z","updated_at":"2014-06-25T19:33:28Z","closed_at":"2013-01-08T21:49:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/701","html_url":"https://github.com/mochajs/mocha/pull/701","diff_url":"https://github.com/mochajs/mocha/pull/701.diff","patch_url":"https://github.com/mochajs/mocha/pull/701.patch","merged_at":"2013-01-08T21:49:15Z"},"body":"- instanceof is faster so put it first:\n  http://jsperf.com/error-instanceof-performance\n","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/701/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/mochajs/mocha/issues/763","repository_url":"https://api.github.com/repos/mochajs/mocha","labels_url":"https://api.github.com/repos/mochajs/mocha/issues/763/labels{/name}","comments_url":"https://api.github.com/repos/mochajs/mocha/issues/763/comments","events_url":"https://api.github.com/repos/mochajs/mocha/issues/763/events","html_url":"https://github.com/mochajs/mocha/pull/763","id":11680688,"node_id":"MDExOlB1bGxSZXF1ZXN0NDk0MzUxOA==","number":763,"title":"mocha browser runner is 10-100x slower than jasmine on equivalent suites","user":{"login":"jfirebaugh","id":98601,"node_id":"MDQ6VXNlcjk4NjAx","avatar_url":"https://avatars.githubusercontent.com/u/98601?v=4","gravatar_id":"","url":"https://api.github.com/users/jfirebaugh","html_url":"https://github.com/jfirebaugh","followers_url":"https://api.github.com/users/jfirebaugh/followers","following_url":"https://api.github.com/users/jfirebaugh/following{/other_user}","gists_url":"https://api.github.com/users/jfirebaugh/gists{/gist_id}","starred_url":"https://api.github.com/users/jfirebaugh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jfirebaugh/subscriptions","organizations_url":"https://api.github.com/users/jfirebaugh/orgs","repos_url":"https://api.github.com/users/jfirebaugh/repos","events_url":"https://api.github.com/users/jfirebaugh/events{/privacy}","received_events_url":"https://api.github.com/users/jfirebaugh/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2013-03-05T18:55:22Z","updated_at":"2014-06-12T14:11:25Z","closed_at":"2013-04-03T00:02:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/mochajs/mocha/pulls/763","html_url":"https://github.com/mochajs/mocha/pull/763","diff_url":"https://github.com/mochajs/mocha/pull/763.diff","patch_url":"https://github.com/mochajs/mocha/pull/763.patch","merged_at":"2013-04-03T00:02:42Z"},"body":"So @tmcw and I were petitioning to [convert Leaflet's test suite to mocha](https://github.com/Leaflet/Leaflet/pull/1479) and @mourner brought it to our attention that the result ran ten times slower (2s with mocha vs 0.2s with Jasmine).\n\nI reproduced a similar slowdown in a simple [benchmark](https://github.com/jfirebaugh/jasmine-mocha-benchmark) which does nothing but execute 500 examples. Jasmine does it in about 0.1s, Mocha 3s.\n\nI suspect Mocha is hitting a wall due to the latency of [window.postMessage](https://github.com/visionmedia/mocha/blob/4d95a875d8c45aa228602a6de42a9c56e5b6a9a8/support/tail.js#L39) used by the `process.nextTick` implementation. Replacing this implementation with synchronous execution of `fn` leads to a sizable performance improvement (but of course regresses #153).\n\nI guess to improve this mocha will need a nextTick worker queue and some manual scheduling logic, so that multiple ticks can run in each setTimeout/postMessage \"timeslice\".\n","reactions":{"url":"https://api.github.com/repos/mochajs/mocha/issues/763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mochajs/mocha/issues/763/timeline","performed_via_github_app":null,"state_reason":null,"score":1}]